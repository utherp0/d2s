<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configuring An Application :: Developer Introduction to OpenShift</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () { 
      const urlParams = new URLSearchParams(window.location.search);
      const clusterName = urlParams.get('CLUSTER_SUBDOMAIN');
      const projectName = urlParams.get('PROJECT');
      if (clusterName) {
        showCluster( clusterName );
      }
      else {
        showClusterForm();
      }

      if (projectName) {
        showProject( projectName );
      } else {
        showProjectForm();
      }
    } );


    function sliceCluster(clusterName){
      if (clusterName.length > 70) {
          return "..." + clusterName.slice(35);
      } else {
          return clusterName;
      }
    }

    function showCluster( clusterName ) {
      document.getElementById('navbar-form-empty').style.display = "none";
      document.getElementById('navbar-form-filled').style.display = "flex";
      document.getElementById('cluster_subdomain').textContent = sliceCluster(clusterName);
      document.getElementById('clusterfield2').value = clusterName;

    }

    function showClusterForm( clusterName ) {
      document.getElementById('navbar-form-empty').style.display = "flex";
      document.getElementById('navbar-form-filled').style.display = "none";
    }

    function gowithcluster() {
      elClusterInput = document.getElementById('clusterfield');
      elProjectInput = document.getElementById('projectfield2');

      window.location.search = ('&CLUSTER_SUBDOMAIN=' + elClusterInput.value + '&PROJECT=' + elProjectInput.value);
    }

    function showProject( projectName ) {
      document.getElementById('navbar-form-project-empty').style.display = "none";
      document.getElementById('navbar-form-project-filled').style.display = "flex";
      document.getElementById('project').textContent = projectName;
      document.getElementById('projectfield2').value = projectName;
    }

    function showProjectForm( projectName ) {
      document.getElementById('navbar-form-project-empty').style.display = "flex";
      document.getElementById('navbar-form-project-filled').style.display = "none";
    }

    function gowithproject() {
      elProjectInput = document.getElementById('projectfield');
      elClusterInput = document.getElementById('clusterfield2');
      window.location.search = ('&CLUSTER_SUBDOMAIN=' + elClusterInput.value + '&PROJECT=' + elProjectInput.value);
    }

  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="../..">Developer Introduction to OpenShift</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item" id="navbar-form-empty">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i style="color: orange;"
              class="fa fa-exclamation-triangle" aria-hidden="true"></i></span>

          <form action="javascript:void(0);" onsubmit="gowithcluster();">
            <input size="40" id="clusterfield" type="text" placeholder="Enter Cluster Subdomain">
            <input type="hidden" id="projectfield2" name="projectfield2" value="">
          </form>
        </div>

        <div class="navbar-item" id="navbar-form-filled" style="display: none;">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">|</span>
          <span class="navbar-text" id="cluster_subdomain"></span>
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i onclick="recycle();" style="color: green;" class="fa fa-recycle" aria-hidden="true"></i></span>
        </div>

         <div class="navbar-item" id="navbar-form-project-empty">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i style="color: orange;"
              class="fa fa-exclamation-triangle" aria-hidden="true"></i></span>

          <form action="javascript:void(0);" onsubmit="gowithproject();">
            <input size="40" id="projectfield" type="text" placeholder="Enter Project Name">
            <input type="hidden" id="clusterfield2" name="clusterfield2" value="">
          </form>
        </div>

        <div class="navbar-item" id="navbar-form-project-filled" style="display: none;">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">|</span>
          <span class="navbar-text" id="project"></span>
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i onclick="recycle();" style="color: green;" class="fa fa-recycle" aria-hidden="true"></i></span>
        </div>
<!---
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-scholars.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
--->
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="d2sdevex" data-version="4.11">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">D2S Introduction to OpenShift Course</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="001_introduction_to_openshift.html"><strong>001</strong> - A High Level Introduction to OpenShift</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="002_deploying_an_application.html"><strong>002</strong> - Deploying an Application to OpenShift</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="003_s2i.html"><strong>003</strong> - Deploying an Application from Source Code</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="004_configuring_an_application.html"><strong>004</strong> - Configuring an Application</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="005_deploying_multiple_applications.html"><strong>005</strong> - Deploying Multiple Apps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="006_config_injection.html"><strong>006</strong> - Injecting Configuration into Apps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="007_secrets.html"><strong>007</strong> - Injecting Secure Configuration into Apps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="008_storage.html"><strong>008</strong> - Adding Storage to Apps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="009_networking_applications.html"><strong>009</strong> - Understanding Application Networking</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="010_pipelines.html"><strong>010</strong> - Introducing Pipelines for Developers</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">D2S Introduction to OpenShift Course</span>
    <span class="version">4.11</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">D2S Introduction to OpenShift Course</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">4.11</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">D2S Introduction to OpenShift Course</a></li>
    <li><a href="004_configuring_an_application.html"><strong>004</strong> - Configuring an Application</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/uther/git/d2s/documentation/modules/ROOT/pages/004_configuring_an_application.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Configuring An Application</h1>
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="_images/004-image001.png" alt="Editing the Deployment Config">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2><strong>Configuring an OpenShift Application</strong></h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>What will you learn?</strong></p>
</div>
<div class="paragraph">
<p>This module will introduce you to the configuration options for the Applications running within OpenShift</p>
</div>
<div class="paragraph">
<p>This will highlight the components you can change and their effect</p>
</div>
<div class="paragraph">
<p>After completing the Module you will be able set various behaviours of the Application running in OpenShift, from the perspective of the way in which the Application is hosted</p>
</div>
</div>
</div>
<div class="sect2">
<h3><strong>Pre-Requisites</strong></h3>
<div class="paragraph">
<p>In order to undertake the Module you need to be logged onto the D2S cluster and have access to a Project. This Project is pre-created for you by the D2S Admins.</p>
</div>
<div class="paragraph">
<p><strong>Ensure the two textboxes at the top of this HTML Guide to the Module contain the D2S Cluster address and the Project you have been assigned.</strong> If not use the 'Copy' button on the text below to get the Cluster address and add it to the Cluster textbox above (pressing <strong>RETURN</strong> after pasting it). Then add the Project name if it is not already there, again pressing <strong>RETURN</strong> after entering it into the field.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">apps.ocp1.azure.dso.digital.mod.uk</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3><strong>Setting up the Application for the Module</strong></h3>
<div class="paragraph">
<p>This Module will explain the mechanics of configuring an Application&#8217;s behaviour while running in OpenShift.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This Module is all about crafting the way in which the Application operates within OpenShift itself. OpenShift hosts the Application as a Pod containing one (or more)
running Containers; in this Module we will adjust the way in which OpenShift hosts the Application, not the actual Application behaviour. In Module 006 we will examine the ways
in which additional information can be provided to a running Application to effect the way in which it operates (using Config Maps and Environment Variables).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the sake of simplicty we will use a similar Application to the one we used in previous Modules.</p>
</div>
<div class="paragraph">
<p>In the D2S UI make sure you are logged on, as stated in the pre-requisites and in the Project provided. Switch the UI to the Developer viewpoint using the selector in the top left.</p>
</div>
<div class="paragraph">
<p>Select <strong>+Add</strong> from the left-hand menu.</p>
</div>
<div class="paragraph">
<p>Click on <strong>Container Images</strong>.</p>
</div>
<div class="paragraph">
<p>Leave the selection of Image on <strong>Image name from external registry</strong>. Copy (or type) the following address into the textbox:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quay.io/ilawson/devex4</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click on the pulldown for the <strong>Application</strong> and select <strong>Create Application</strong>. In the <strong>Application Name</strong> textbox enter config-app. Set the <strong>Name</strong> to configexample.</p>
</div>
<div class="paragraph">
<p>In <strong>Resources</strong> set the resource type to <strong>DeploymentConfig</strong>. Hit <strong>Create</strong> to start the Application creation and deployment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As this is a create from Image it should setup the example application quickly. No build will be executed and the Topology page should appear with the application displayed as below.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/004-image002.png" alt="Running example Application" width="300px">
</div>
</div>
</div>
<div class="sect2">
<h3><strong>Examining the Deployment Configuration for the Application</strong></h3>
<div class="paragraph">
<p>Click on the roundel for the Application. The panel that appears on the right of the Topology page will display the Deployment Configuration for the Application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift uses two Objects for defining how an Application is deployed; a <strong>Deployment</strong>, which is the standard Kubernetes definition of a deployment (Image location and replicas), or a <strong>DeploymentConfig</strong>, which is the extended OpenShift object.<br></p>
</div>
<div class="paragraph">
<p>In this Module we will be examining and editing the DeploymentConfig created as part of the Application deployment.<br></p>
</div>
<div class="paragraph">
<p>The panel that appears will have an icon with the letters <strong>DC</strong> on it at the title of the tab. These icons are shortcuts for the type of Object being displayed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/004-image003.png" alt="DC sidepanel">
</div>
</div>
<div class="paragraph">
<p>Click on the <strong>Details</strong> tab. This will switch the right-hand panel to show more information about the way in which the Application is deployed</p>
</div>
</div>
<div class="sect2">
<h3><strong>Scaling the Application up and down</strong></h3>
<div class="paragraph">
<p>In the Details tab you will see another Roundel; this one indicates the number of active replicas for the application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Kubernetes and OpenShift have a concept called 'ReplicationControllers' which are tasked with making sure that the
required number of replicas of an Application are running at all times. These replicas are exact copies of the Application from the Image (with
separate Pods/file systems).<br></p>
</div>
<div class="paragraph">
<p>As with all Kubernetes objects these replicas <em>reconcile</em> physically. They exist on the Worker nodes, which communicate back to the
control plane of OpenShift through the <em>Kubelet</em>. If a replica fails or, for example, a Worker Node goes offline, the ReplicationController
instantly detects that the required number of replicas is not physically active, and will recreate the replica somewhere within the Cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/004-image004.png" alt="The Scaling Roundel" width="300px">
</div>
</div>
<div class="paragraph">
<p>Now we will scale our Application up to four replicas. Do this by clicking on the Up arrow next to the Roundel until the replica count in the Roundel indicates four copies. Watch the behaviour of the Roundel as you do this.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Roundel will divide into four effective quadrants, one for each of the replicas. As each of the replicas is started the quadrant will change from light blue (starting) to
dark blue (active).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you now click on the <strong>Resources</strong> tab. Note that the Pods panel now displays that there are four active pods (three displayed).</p>
</div>
<div class="paragraph">
<p>Click on the <strong>View all 4</strong> link. The content page will change to list all the active Pods for this Application.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/004-image005.png" alt="List of Pods for the Application Deployment">
</div>
</div>
<div class="paragraph">
<p>Click on <strong>Topology</strong> again. On the right-hand panel click on <strong>Details</strong> again. Using the Down arrow next to the Roundel set the number of replicas to zero. Watch the Roundel switch to a blank empty one as the system removes all the copies.</p>
</div>
</div>
<div class="sect2">
<h3><strong>Changing the Deployment Strategy</strong></h3>
<div class="paragraph">
<p>One of the nice features about using the OpenShift <strong>DeploymentConfig</strong> is that it supports two distinct and different Deployment Strategies.</p>
</div>
<div class="paragraph">
<p>These reflect two distinct world usecases; zero downtime upgrade and security specific upgrades.</p>
</div>
<div class="sect3">
<h4><strong>Zero Downtime Upgrade</strong></h4>
<div class="paragraph">
<p>A real world example; you have an Application that you have spent a good deal of time writing. When it is deployed you notice that the HTML Title has a spelling mistake in it. This is a cosmetic error and the Application is being used in anger by a number of people. In the old days this
would require taking the Application offline, fixing the error, then redeploying. With OpenShift we support a Deployment Strategy called <strong>Rolling</strong> which allows you to roll out an application
in a staged way so as not to interrupt use of the Application.</p>
</div>
<div class="paragraph">
<p>To make this easier to visualise we are going to change the options on the topology to be able to see the state of the Application better. Switch to the Topology view. Under the Project name in the top left of the Topology
panel there is a pulldown marked <strong>Display options</strong>. Click on this and then under <strong>Show</strong> click on <strong>Pod count</strong>. This will change the viewpoint to display the number of active Pods and their states in the centre of the Roundel on the Topology
tab. It should state 'Scaled to 0'.</p>
</div>
<div class="paragraph">
<p>We will now demonstrate this - scale the Application up to <strong>3</strong> replicas using the Up arrow next to the empty Roundel in the right hand information panel, within the <strong>Resources</strong> tab. Wait until the three replicas are all running correctly (the Roundel will be dark blue).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/004-image006.png" alt="Scaling to three replicas" width="300px" height="200px">
</div>
</div>
<div class="paragraph">
<p>Underneath the Roundel you will see an indicator that the Deployment has an update strategy of <strong>Rolling</strong>. What we are going to do is perform a Rollout.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Starting a Rollout forces the ReplicationController to redeploy the active replicas. We will see the different ways in which the rollout is applied depending on the Strategy chosen.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the right-hand panel for the <strong>DeploymentConfig</strong> you should see an indicator that this rollout is at version 1 (under the <strong>Latest version</strong> label). Select the <strong>Actions</strong> pulldown and
choose <strong>Start Rollout</strong>. Carefully watch the Roundels in the right-hand panel.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/004-image008.png" alt="Rolling rollout">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>What you are seeing is as follows; the left-hand Roundel indicates the state of the previous rollout, the right-hand Roundel displays the new Rollout.<br></p>
</div>
<div class="paragraph">
<p>The ReplicationController starts by spinning up one copy of the new Rollout - this could be a change to the code, a change to the DeploymentConfig, a change to the environment variables etc. When the single instance of the new deployment
has started correctly (the Roundel will go dark blue), the ReplicationController <strong>removes</strong> one of the old Pods.<br></p>
</div>
<div class="paragraph">
<p>At <strong>all</strong> points the count of active Pods, a mix of new and old, equals or just exceeds the required number of replicas.<br></p>
</div>
<div class="paragraph">
<p>The ReplicationController then proceeds to startup the new Pods, one by one, performing the same 'startup, teardown' approach with the old Pods until no old Pods
exist<br></p>
</div>
<div class="paragraph">
<p>This gives the <strong>zero downtime</strong> functionality</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now choose <strong>Actions</strong> and then <strong>Edit DeploymentConfig</strong>.</p>
</div>
<div class="paragraph">
<p>In the <strong>Deployment Strategy</strong> section change the <strong>Strategy type</strong> to <strong>Recreate</strong> (as shown below)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/004-image007.png" alt="Choosing the Recreate strategy" width="400px">
</div>
</div>
<div class="paragraph">
<p>Click <strong>Save</strong>. The UI will shift back to the topology page. Pull down the Actions menu again and click <strong>Start rollout</strong>. Watch carefully the Roundels in the right-hand information panel.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/004-image009.png" alt="Recreate rollout">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>What you are now seeing is the 'security shutdown' approach to Applications; the real world example of this is that you have found an exploit in the Application and need to patch it fast, and when you start the
patch there must be <strong>no</strong> running copies of the previous version.<br></p>
</div>
<div class="paragraph">
<p>The <strong>Recreate</strong> strategy removes <em>all</em> the running instances of the Application before starting to rollout the new copies.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
